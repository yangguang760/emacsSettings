* Yang's settings for emacs
** Public settings
#+BEGIN_SRC emacs-lisp
(server-start)
(setq default-directory "~/")


(setq org-startup-indented t)
(require 'package)
(package-initialize)
(push '("marmalade" . "http://marmalade-repo.org/packages/")
        package-archives )
(push '("melpa" . "http://melpa.org/packages/")
        package-archives)
(starter-kit-load "haskell")
(starter-kit-load "yasnippet")
(tool-bar-mode 0) 
(auto-image-file-mode t)
(add-hook 'org-mode-hook (lambda () 
                           (global-visual-line-mode t)))

#+END_SRC
*** Settings for fonts
#+BEGIN_SRC emacs-lisp


(require 'chinese-fonts-setup)

#+END_SRC

** Settings for Evil and ace-jump
#+BEGIN_SRC emacs-lisp
(require 'evil)
(setq sentence-end "\\([。！？]\\|……\\|[.?!][]\"')}]*\\($\\|[ \t]\\)\\)[ \t\n]*")  
(setq sentence-end-double-space nil)  
(require 'org)
(require 'evil-leader)
(require 'evil-org)
(add-to-list 'load-path "~/.emacs.d/elpa/helm")
(require 'ace-jump-buffer)
(require 'relative-line-numbers)
(evil-mode 1)
(global-evil-leader-mode)
(org-babel-do-load-languages
 'org-babel-load-languages
 '((R . t)
   (emacs-lisp . t)
   (matlab . t)
   (C . t)
   (perl . t)
   (sh . t)
   (ditaa . t)
   (python . t)
   (haskell . t)
   (dot . t)
   (latex . t)
   (js . t)
   ))

(autoload
  'ace-jump-mode
  "ace-jump-mode"
  "Emacs quick move minor mode"
  t)
;;(global-relative-line-numbers-mode)
#+END_SRC

** Settings for helm
#+BEGIN_SRC emacs-lisp
(require 'helm-config)
(helm-mode 1)
#+END_SRC

** Settings for color theme
#+BEGIN_SRC emacs-lisp
(require 'powerline)
(require 'moe-theme)
(require 'moe-theme-switcher)
(setq calendar-latitude +40)
(setq calendar-longitude +116)
;; Choose the one you like, (moe-light) or (moe-dark)

(setq moe-theme-resize-org-title '(1.3 1.2 1.1 1.0 1.0 1.0 1.0))
(moe-theme-set-color 'blue)
;;(require 'color-theme)
;;(color-theme-initialize)
;;(color-theme-oswald)
(setq truncate-lines nil)
(powerline-moe-theme)


#+END_SRC

** Settings for org-mode
#+BEGIN_SRC emacs-lisp 
;;(require 'org-plus-contrib)
(require 'ox-reveal)
(require 'ox-deck)
(setq org-clock-persist 'history)
(setq org-clock-persistence t)
(setq org-agenda-buffer-tmp-name "*Org Agenda*")
(setq org-log-done 'time)
(setq org-log-repeat 'note)
(setq org-icalendar-use-scheduled '(todo-start event-if-todo))
(setq org-icalendar-use-scheduled '(todo-end event-if-todo))
(setq org-agenda-default-appointment-duration 60)

(defun org-summary-todo (n-done n-not-done)
       "Switch entry to DONE when all subentries are done, to TODO otherwise."
    (let (org-log-done org-log-states)   ; turn off logging
    (org-todo (if (= n-not-done 0) "DONE" "TODO"))))
 (setq org-default-notes-file (concat org-directory "/notes.org"))
(evil-ex-define-cmd "ls" 'helm-mini)
(setq org-mobile-directory "~/mobileorg")
(add-hook 'org-mode-hook (lambda () (org-autolist-mode)))
(setq org-reveal-root "file:///d:/reveal.js")
(setq org-agenda-files (list "~/org"))

(setq org-capture-templates
      '(("t" "Todo" entry (file+headline "~/org/todos.org" "misc-todos")
             "* TODO %?\n  %x %i\n  %t")
        ("i" "Inbox" entry (file+headline "~/org/todos.org" "Inbox")
             "* %? :UNPLANNED:\n  %x %i\n  %t ")))


(require 'ox-publish)
(setq org-publish-project-alist
      '(
        ("blog-notes"
         :base-directory "~/org/blog/"
         :base-extension "org"
         :publishing-directory "~/org/yangguang760.github.io/"
         :recursive t
         :publishing-function org-html-publish-to-html
         :headline-levels 4
         :section-numbers nil
         :auto-preamble t
         :auto-sitemap t                ; Generate sitemap.org automagically...
         :sitemap-filename "sitemap.org"  ; ... call it sitemap.org (it's the default)...
         :sitemap-title "Sitemap"         ; ... with title 'Sitemap'.
         :author "YANG Guang"
         :email "yangguang760 at gmail dot com"
         :style    "<link rel=\"stylesheet\" type=\"text/css\" href=\"css/worg.css\"/>"
         )
        ("blog-static"
         :base-directory "~/org/blog/"
         :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf"
         :publishing-directory "~/org/yangguang760.github.io/"
         :recursive t
         :publishing-function org-publish-attachment
         )
        ("blog" :components ("blog-notes" "blog-static"))
        ;;
        ))
(setq org-html-postamble "<div id=\"disqus_thread\"></div>
    <script type=\"text/javascript\">
     
        var disqus_shortname = 'yangguang760githubio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by Disqus.</a></noscript>")
(require 'ox-latex)
(add-to-list 'org-latex-classes
             '("cn-article"
               "\\documentclass[10pt,a4paper]{article}
\\usepackage{graphicx}
\\usepackage{xcolor}
\\usepackage{xeCJK}
\\usepackage{lmodern}
\\usepackage{verbatim}
\\usepackage{fixltx2e}
\\usepackage{longtable}
\\usepackage{float}
\\usepackage{tikz}
\\usepackage{wrapfig}
\\usepackage{soul}
\\usepackage{textcomp}
\\usepackage{listings}
\\usepackage{geometry}
\\usepackage{algorithm}
\\usepackage{algorithmic}
\\usepackage{marvosym}
\\usepackage{wasysym}
\\usepackage{latexsym}
\\usepackage{natbib}
\\usepackage{fancyhdr}
\\usepackage[xetex,colorlinks=true,CJKbookmarks=true,
linkcolor=blue,
urlcolor=blue,
menucolor=blue]{hyperref}
\\usepackage{fontspec,xunicode,xltxtra}
\\setmainfont[BoldFont=Microsoft YaHei]{Microsoft YaHei}  
\\setsansfont[BoldFont=Microsoft YaHei]{Microsoft YaHei}
\\setmonofont{Microsoft YaHei}  
\\newcommand\\fontnamemono{Microsoft YaHei}%等宽字体
\\newfontinstance\\MONO{\\fontnamemono}
\\newcommand{\\mono}[1]{{\\MONO #1}}
\\setCJKmainfont[Scale=0.9]{WenQuanYi Micro Hei}%中文字体
\\setCJKsansfont[Scale=0.9]{WenQuanYi Micro Hei}
\\setCJKmonofont[Scale=0.9]{WenQuanYi Micro Hei Mono}
\\hypersetup{unicode=true}
\\geometry{a4paper, textwidth=6.5in, textheight=10in,
marginparsep=7pt, marginparwidth=.6in}
\\definecolor{foreground}{RGB}{220,220,204}%浅灰
\\definecolor{background}{RGB}{62,62,62}%浅黑
\\definecolor{preprocess}{RGB}{250,187,249}%浅紫
\\definecolor{var}{RGB}{239,224,174}%浅肉色
\\definecolor{string}{RGB}{154,150,230}%浅紫色
\\definecolor{type}{RGB}{225,225,116}%浅黄
\\definecolor{function}{RGB}{140,206,211}%浅天蓝
\\definecolor{keyword}{RGB}{239,224,174}%浅肉色
\\definecolor{comment}{RGB}{180,98,4}%深褐色
\\definecolor{doc}{RGB}{175,215,175}%浅铅绿
\\definecolor{comdil}{RGB}{111,128,111}%深灰
\\definecolor{constant}{RGB}{220,162,170}%粉红
\\definecolor{buildin}{RGB}{127,159,127}%深铅绿
\\punctstyle{kaiming}
\\title{}
\\fancyfoot[C]{\\bfseries\\thepage}
\\chead{\\MakeUppercase\\sectionmark}
\\pagestyle{fancy}
\\tolerance=1000
[NO-DEFAULT-PACKAGES]
[NO-PACKAGES]"
("\\section{%s}" . "\\section*{%s}")
("\\subsection{%s}" . "\\subsection*{%s}")
("\\subsubsection{%s}" . "\\subsubsection*{%s}")
("\\paragraph{%s}" . "\\paragraph*{%s}")
("\\subparagraph{%s}" . "\\subparagraph*{%s}")))


(add-to-list 'org-latex-classes
	   '("article-zh"
	     "
\\documentclass{article}
\\usepackage[slantfont, boldfont]{xeCJK}
\\setCJKmainfont{WenQuanYi Micro Hei}
\\setCJKsansfont{WenQuanYi Micro Hei}
\\setCJKmonofont{WenQuanYi Micro Hei Mono}
"
	     ("\\section{%s}" . "\\section*{%s}")
	     ("\\subsection{%s}" . "\\subsection*{%s}")
	     ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
	     ("\\paragraph{%s}" . "\\paragraph*{%s}")
	     ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))

(setq org-latex-pdf-process '("xelatex -interaction nonstopmode -output-directory %o %f"
			      "xelatex -interaction nonstopmode -output-directory %o %f"
			      "xelatex -interaction nonstopmode -output-directory %o %f"))



  (defun sl/display-header ()
(setq header-line-format
       (list "-"

        'global-mode-string
)))



  (add-hook 'buffer-list-update-hook
            'sl/display-header)

#+END_SRC
** Settings for gnus
#+BEGIN_SRC emacs-lisp 
 (require 'gnus)
  (setq nnml-directory "~/gmail")
  (setq message-directory "~/gmail")
 (setq gnus-ignored-newsgroups "^to\\.\\|^[0-9. ]+\\( \\|$\\)\\|^[\”]\”[#’()]")
  (setq gnus-select-method
        '(nnimap "gmail"
                 (nnimap-address "imap.gmail.com")
                 (nnimap-server-port 993)
                 (nnimap-stream ssl)))

  (setq message-send-mail-function 'smtpmail-send-it
        smtpmail-starttls-credentials '(("smtp.gmail.com" 587 nil nil))
        smtpmail-auth-credentials '(("smtp.gmail.com" 587 "yangguang760@gmail.com" nil))
        smtpmail-default-smtp-server "smtp.gmail.com"
        smtpmail-smtp-server "smtp.gmail.com"
        smtpmail-smtp-service 587)

(set-language-environment 'Chinese-GB)
(setq gnus-default-charset 'chinese-iso-8bit
      gnus-group-name-charset-group-alist '((".*" . cn-gb-2312))
      gnus-summary-show-article-charset-alist
      '((1 . cn-gb-2312)
	(2 . gb18030)
	(3 . chinese-iso-8bit)
	(4 . gbk)
	(5 . big5)
	(6 . utf-8))
      gnus-newsgroup-ignored-charsets
      '(unknown-8bit x-unknown iso-8859-1))


(require 'bbdb)
(require 'bbdb-autoloads)
(setq
 bbdb-file "~/.bbdb"
 bbdb-offer-save 'auto
 bbdb-notice-auto-save-file t
 bbdb-expand-mail-aliases t
 bbdb-canonicalize-redundant-nets-p t
 bbdb-always-add-addresses t
 bbdb-complete-name-allow-cycling t
 )
(bbdb-initialize) 
(add-hook 'gnus-startup-hook 'bbdb-insinuate-gnus) 
(add-hook 'gnus-startup-hook 'bbdb-insinuate-message) 
(add-hook 'message-setup-hook 'bbdb-define-all-aliases) 
(setq bbdb-file-coding-system 'utf-8)

(add-hook 'bbdb-load-hook
   (lambda () (setq bbdb-file-coding-system 'utf-8)))

(setq file-coding-system-alist
   (cons '("\\.bbdb" utf-8 . utf-8)
       file-coding-system-alist))



     (setq ps-printer-name t)
     (setq ps-lpr-command "D:/Software/daily/CTEX/Ghostscript/gs9.05/bin/gswin32c.exe")
     (setq ps-lpr-switches '("-q" "-dNOPAUSE" "-dBATCH"
                             "-sDEVICE=mswinpr2"
                             "-sPAPERSIZE=a4"))



(require 'cal-china-x)
(setq mark-holidays-in-calendar t)
(setq cal-china-x-important-holidays cal-china-x-chinese-holidays)
(setq calendar-holidays cal-china-x-important-holidays)

;; (desktop-save-mode nil)
 ;;(desktop-load-default)
;;(desktop-read)


#+END_SRC
